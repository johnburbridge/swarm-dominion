name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  GODOT_VERSION: "4.3.1"

jobs:
  lint:
    name: GDScript Lint
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.11'

      - name: Install gdtoolkit
        run: pip install gdtoolkit

      - name: Check GDScript format
        run: |
          if [ -d "scripts" ]; then
            gdformat --check scripts/
          fi
        continue-on-error: true

      - name: Run GDScript linter
        run: |
          if [ -d "scripts" ]; then
            gdlint scripts/
          fi
        continue-on-error: true

  # TODO: Enable when GUT tests are set up
  # test:
  #   name: Unit Tests
  #   runs-on: ubuntu-latest
  #   needs: lint
  #
  #   steps:
  #     - uses: actions/checkout@v4
  #
  #     - name: Download Godot
  #       run: |
  #         wget -q https://github.com/godotengine/godot/releases/download/${{ env.GODOT_VERSION }}-stable/Godot_v${{ env.GODOT_VERSION }}-stable_linux.x86_64.zip
  #         unzip -q Godot_v${{ env.GODOT_VERSION }}-stable_linux.x86_64.zip
  #         chmod +x Godot_v${{ env.GODOT_VERSION }}-stable_linux.x86_64
  #
  #     - name: Run GUT tests
  #       run: |
  #         ./Godot_v${{ env.GODOT_VERSION }}-stable_linux.x86_64 --headless -s addons/gut/gut_cmdln.gd
